import{E as x,_ as N,m as D,g as P,c as u,a as e,d as C,t as v,F as U,h as E,b as c,D as w,w as T,r,o as d,n as k,k as A,v as I}from"./index-DrFV_QdC.js";import{d as $}from"./dateMixin-rxM5WT6e.js";import{a as g}from"./axios-L6U4YIEh.js";import{P as q}from"./PaginationComponent-dX_-oPi3.js";import{L as B}from"./LoadingComponent-t_OXttSM.js";var M={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"hsuanin-vue2024",BASE_URL:"/2023-vue-week7/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:m,VITE_PATH:_}=M,y=x("couponStore",{state:()=>({coupons:[],page:{},totalCount:0,isLoading:!1}),actions:{getCoupons(s=1){this.isLoading=!this.isLoading;const o=`${m}/api/${_}/admin/coupons?page=${s}`;g.get(o).then(n=>{const{coupons:i,pagination:t}=n.data;this.coupons=i,this.page=t,this.isLoading=!this.isLoading}).catch(n=>{alert(n.response.data.message),console.log(n)})},updateCoupons(s,o){console.log(s,o);let n=`${m}/api/${_}/admin/coupon/${o.id}`,i="put";s==="new"&&(n=`${m}/api/${_}/admin/coupon`,i="post"),console.log(n,i),g[i](n,{data:o}).then(t=>{alert(t.data.message),this.getCoupons()}).catch(t=>{alert(t.response.data.message)})},delProduct(s){const o=`${m}/api/${_}/admin/coupon/${s}`;g.delete(o).then(n=>{alert(n.data.message),this.getCoupons()}).catch(n=>{alert(n.response.data.message)})},switchStatus(s,o){const n=s.target.checked?1:0,i={...o,is_enabled:n};g.put(`${m}/api/${_}/admin/coupon/${o.id}`,{data:i}).then(()=>{this.getCoupons()}).catch(t=>alert(t.response.data.message))}}}),O={components:{PaginationComponent:q,LoadingComponent:B},mixins:[$],data(){return{tempCoupon:{},status:"",isNoClick:!0}},computed:{...D(y,["coupons","page","isLoading"]),due_date:{get(){return this.formatDate(this.tempCoupon.due_date)},set(s){this.tempCoupon.due_date=this.parseDate(s)}}},methods:{...P(y,["getCoupons","switchStatus","updateCoupons","delProduct"]),openCoupon(s){this.isNoClick=!1,this.tempCoupon=s?{...s}:{is_enabled:0},this.status=s?"edit":"new"},confirmUpdate(){this.tempCoupon.id?(console.log("edit"),this.updateCoupons("edit",this.tempCoupon)):(console.log("new"),this.updateCoupons("new",this.tempCoupon))}},mounted(){this.getCoupons()}},R={class:"row bg-background rounded-3 py-3"},F=e("h2",{class:"col-12 pt-3 text-primary fw-bolder"},"優惠券管理",-1),H={class:"col-12"},j={class:"fs-4 text-success fw-bold mx-2"},z={class:"col-12"},G={class:"row"},J={class:"list-item-container col-5"},K=["onClick"],Q={class:"badge bg-success me-2"},W=e("span",{class:"arrow text-success"},"›",-1),X={key:0,class:"d-flex justify-content-center align-items-center"},Y={key:1},Z={class:"mb-3 form-switch"},ee=e("label",{class:"form-check-label me-3",for:"test"},"是否開啟",-1),oe=["checked"],se={class:"mb-3"},te=e("label",{for:"couponName",class:"form-label is-required"},"優惠券名稱",-1),ne={class:"mb-3"},ae=e("label",{for:"couponNum",class:"form-label is-required"},"優惠碼",-1),ie={class:"mb-3"},le=e("label",{for:"couponDiscount",class:"col-3"},"折扣",-1),ce={class:"mb-3"},de=e("label",{for:"couponName",class:"col-3"},"有效日期",-1),pe={class:"d-flex"},ue=["disabled"];function re(s,o,n,i,t,p){const V=r("pagination-component"),L=r("loading-component"),f=r("v-field"),b=r("error-message"),S=r("v-form");return d(),u("div",R,[F,e("div",H,[e("span",null,[C("目前共有"),e("span",j,v(s.coupons.length),1),C("張優惠券")])]),e("div",null,[e("div",z,[e("button",{type:"button",class:"btn btn-outline-primary mb-3",onClick:o[0]||(o[0]=l=>p.openCoupon(s.coupon))},"新增優惠券"),e("div",G,[e("div",J,[(d(!0),u(U,null,E(s.coupons,l=>(d(),u("ul",{class:"list-group",key:l.id+1},[e("li",{class:"list-group-item me-2 text-secondary",onClick:h=>p.openCoupon(l)},[e("span",Q,v(l.is_enabled==1?"開啟":"關閉"),1),C(" "+v(l.title)+" ",1),W],8,K)]))),128)),c(V,{pages:s.page,"get-items":s.getCoupons,class:"mt-2"},null,8,["pages","get-items"])]),s.isLoading?(d(),w(L,{key:0,isLoading:s.isLoading},null,8,["isLoading"])):(d(),w(S,{key:1,class:"col-7",onSubmit:p.confirmUpdate,ref:"form"},{default:T(({meta:l,errors:h})=>[t.isNoClick?(d(),u("div",X,"目前未選擇任何優惠券")):(d(),u("div",Y,[e("div",null,[e("div",Z,[ee,e("input",{class:"form-check-input ms-5",type:"checkbox",role:"switch",id:"test",checked:t.tempCoupon.is_enabled,onChange:o[1]||(o[1]=a=>s.switchStatus(a,t.tempCoupon))},null,40,oe)]),e("div",se,[te,c(f,{id:"couponName",name:"優惠券名稱",type:"text",class:k(["form-control",{"is-invalid":h.優惠券名稱}]),placeholder:"請輸入優惠券名稱",rules:"required",modelValue:t.tempCoupon.title,"onUpdate:modelValue":o[2]||(o[2]=a=>t.tempCoupon.title=a)},null,8,["class","modelValue"]),c(b,{name:"優惠券名稱",class:"invalid-feedback"})]),e("div",ne,[ae,c(f,{id:"couponNum",name:"優惠碼",type:"text",class:k(["form-control",{"is-invalid":h.優惠碼}]),placeholder:"請輸入優惠碼",rules:"required",modelValue:t.tempCoupon.code,"onUpdate:modelValue":o[3]||(o[3]=a=>t.tempCoupon.code=a)},null,8,["class","modelValue"]),c(b,{name:"優惠碼",class:"invalid-feedback"})]),e("div",ie,[le,c(f,{id:"couponDiscount",name:"折扣",type:"number",class:k(["form-control",{"is-invalid":h.折扣}]),placeholder:"請輸入折扣",rules:"required|integer|min_value:1|max_value:100",modelValue:t.tempCoupon.percent,"onUpdate:modelValue":o[4]||(o[4]=a=>t.tempCoupon.percent=a)},null,8,["class","modelValue"]),c(b,{name:"折扣",class:"invalid-feedback"})]),e("div",ce,[de,A(e("input",{id:"due_date",type:"date",class:"form-control","onUpdate:modelValue":o[5]||(o[5]=a=>p.due_date=a)},null,512),[[I,p.due_date]])])]),e("div",pe,[e("button",{type:"submit",class:"btn btn-outline-success me-2",disabled:!l.valid},"確認",8,ue),e("button",{type:"button",class:"btn btn-outline-info",onClick:o[6]||(o[6]=a=>s.delProduct(t.tempCoupon.id))},"刪除")])]))]),_:1},8,["onSubmit"]))])])])])}const be=N(O,[["render",re]]);export{be as default};
