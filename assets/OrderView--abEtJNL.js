import{a as p}from"./axios-L6U4YIEh.js";import{B as C}from"./modal-BarFWhKM.js";import{d as O}from"./dateMixin-rxM5WT6e.js";import{_ as f,o as l,c as d,a as t,t as s,j as m,F as h,h as b,k,H as x,d as y,b as $,r as g,n as w}from"./index-3DxD6gY9.js";const v={methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()}},mounted(){this.modal=new C(this.$refs.modal)}},D={props:{order:{type:Object,default(){return{}}}},data(){return{modal:"",tempOrder:{},isPaid:!1}},emits:["update-paid"],mixins:[v,O],watch:{order(){this.tempOrder=this.order}}},P={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},V={class:"modal-dialog modal-xl",role:"document"},E={class:"modal-content border-0"},B=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),L={class:"modal-body"},S={class:"row"},U={class:"col-md-4"},I=t("h3",null,"用戶資料",-1),j={class:"table"},N={key:0},T=t("th",{style:{width:"100px"}},"姓名",-1),A=t("th",null,"Email",-1),R=t("th",null,"電話",-1),q=t("th",null,"地址",-1),F={class:"col-md-8"},H=t("h3",null,"訂單細節",-1),z={class:"table"},G=t("th",{style:{width:"100px"}},"訂單編號",-1),J=t("th",null,"下單時間",-1),K=t("th",null,"付款狀態",-1),Q={key:0,class:"text-success"},W={key:1,class:"text-muted"},X=t("th",null,"總金額",-1),Y=t("h3",null,"選購商品",-1),Z={class:"table"},tt=t("thead",null,[t("tr")],-1),et={class:"text-end"},st={class:"d-flex justify-content-end"},ot={class:"form-check"},lt={class:"form-check-label",for:"flexCheckDefault"},dt={key:0},nt={key:1},at={class:"modal-footer"},rt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function it(o,n,r,u,e,_){return l(),d("div",P,[t("div",V,[t("div",E,[B,t("div",L,[t("div",S,[t("div",U,[I,t("table",j,[e.tempOrder.user?(l(),d("tbody",N,[t("tr",null,[T,t("td",null,s(e.tempOrder.user.name),1)]),t("tr",null,[A,t("td",null,s(e.tempOrder.user.email),1)]),t("tr",null,[R,t("td",null,s(e.tempOrder.user.tel),1)]),t("tr",null,[q,t("td",null,s(e.tempOrder.user.address),1)])])):m("",!0)])]),t("div",F,[H,t("table",z,[t("tbody",null,[t("tr",null,[G,t("td",null,s(e.tempOrder.id),1)]),t("tr",null,[J,t("td",null,s(o.formatDate(e.tempOrder.create_at)),1)]),t("tr",null,[K,t("td",null,[e.tempOrder.is_paid?(l(),d("strong",Q,"已付款")):(l(),d("span",W,"尚未付款"))])]),t("tr",null,[X,t("td",null,s(e.tempOrder.total),1)])])]),Y,t("table",Z,[tt,t("tbody",null,[(l(!0),d(h,null,b(e.tempOrder.products,i=>(l(),d("tr",{key:i.id},[t("th",null,s(i.product.title),1),t("td",null,s(i.qty)+" / "+s(i.product.unit),1),t("td",et,s(i.final_total),1)]))),128))])]),t("div",st,[t("div",ot,[k(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":n[0]||(n[0]=i=>e.tempOrder.is_paid=i)},null,512),[[x,e.tempOrder.is_paid]]),t("label",lt,[e.tempOrder.is_paid?(l(),d("span",dt,"已付款")):(l(),d("span",nt,"未付款"))])])])])])]),t("div",at,[rt,t("button",{type:"button",class:"btn btn-primary",onClick:n[1]||(n[1]=i=>o.$emit("update-paid",e.tempOrder))}," 修改付款狀態 ")])])])],512)}const ct=f(D,[["render",it]]),_t={props:{item:Object},emits:["del-item"],mixins:[v]},ut={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},ht={class:"modal-dialog",role:"document"},pt={class:"modal-content border-0"},mt={class:"modal-header bg-warning text-primary"},bt={class:"modal-title"},ft=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),yt={class:"modal-body"},$t={class:"text-danger"},gt={class:"modal-footer"},Ot=t("button",{type:"button",class:"btn btn-outline-info","data-bs-dismiss":"modal"}," 取消 ",-1);function kt(o,n,r,u,e,_){return l(),d("div",ut,[t("div",ht,[t("div",pt,[t("div",mt,[t("h5",bt,[t("span",null,"刪除 "+s(r.item.title),1)]),ft]),t("div",yt,[y(" 是否刪除 "),t("strong",$t,s(r.item.title),1),y(" (刪除後將無法恢復)。 ")]),t("div",gt,[Ot,t("button",{type:"button",class:"btn btn-danger",onClick:n[0]||(n[0]=i=>o.$emit("del-item"))}," 確認刪除 ")])])])],512)}const xt=f(_t,[["render",kt]]);var vt={BASE_URL:"/undefined/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_API:Mt,VITE_PATH:Ct}=vt,wt={data(){return{orders:{},tempOrder:{},currentPage:1,url:Mt,path:Ct}},components:{OrderModal:ct,DelModal:xt},mixins:[O],methods:{getOrders(o=1){this.currentPage=o;const n=`${this.url}/api/${this.path}/admin/orders?page=${o}`;this.isLoading=!0,p.get(n).then(r=>{console.log(r),this.orders=r.data.orders,this.pagination=r.data.pagination}).catch(r=>{console.log(r.response.data.message),alert(r)})},openModal(o){this.tempOrder={...o},this.$refs.orderModal.openModal()},openDelOrderModal(o){this.tempOrder={...o},this.$refs.delModal.openModal()},updatePaid(o){const n=`${this.url}/api/${this.path}/admin/order/${o.id}`,r={is_paid:o.is_paid};p.put(n,{data:r}).then(u=>{console.log(u),this.$refs.orderModal.hideModal(),this.getOrders(this.currentPage)}).catch(u=>{console.log(u.response.data.message),alert("未成功更新訂單資料")})},delOrder(){const o=`${this.url}/api/${this.path}/admin/order/${this.tempOrder.id}`;p.delete(o).then(()=>{this.$refs.delModal.hideModal(),this.getOrders(this.currentPage)}).catch(n=>{alert(n.response.data.message)})}},created(){this.getOrders()}},Dt={class:"row bg-background rounded-3 py-3"},Pt=t("h2",{class:"pt-3 text-primary fw-bolder"},"訂單",-1),Vt={class:"col-12"},Et={class:"table mt-4"},Bt=t("thead",null,[t("tr",{class:"fw-bolder"},[t("th",null,"購買時間"),t("th",null,"Email"),t("th",null,"購買款項"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Lt=["textContent"],St={class:"list-unstyled"},Ut={class:"text-right"},It={class:"form-check form-switch"},jt=["id","onUpdate:modelValue","onChange"],Nt=["for"],Tt={key:0},At={key:1},Rt={class:"btn-group"},qt=["onClick"],Ft=["onClick"];function Ht(o,n,r,u,e,_){const i=g("OrderModal"),M=g("DelModal");return l(),d("div",Dt,[Pt,t("div",Vt,[t("table",Et,[Bt,t("tbody",null,[(l(!0),d(h,null,b(e.orders,a=>(l(),d(h,{key:a.id+1},[e.orders.length?(l(),d("tr",{key:0,class:w({"text-secondary":!a.is_paid})},[t("td",null,s(o.formatDate(a.create_at)),1),t("td",null,[a.user?(l(),d("span",{key:0,textContent:s(a.user.email)},null,8,Lt)):m("",!0)]),t("td",null,[t("ul",St,[(l(!0),d(h,null,b(a.products,c=>(l(),d("li",{key:c.id},s(c.product.title)+" 數量："+s(c.qty)+" "+s(c.product.unit),1))),128))])]),t("td",Ut,s(a.total),1),t("td",null,[t("div",It,[k(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${a.id}`,"onUpdate:modelValue":c=>a.is_paid=c,onChange:c=>_.updatePaid(a)},null,40,jt),[[x,a.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${a.id}`},[a.is_paid?(l(),d("span",Tt,"已付款")):(l(),d("span",At,"未付款"))],8,Nt)])]),t("td",null,[t("div",Rt,[t("button",{class:"btn btn-outline-success btn-sm",type:"button",onClick:c=>_.openModal(a)}," 檢視 ",8,qt),t("button",{class:"btn btn-outline-info btn-sm",type:"button",onClick:c=>_.openDelOrderModal(a)}," 刪除 ",8,Ft)])])],2)):m("",!0)],64))),128))])])]),$(i,{ref:"orderModal",order:e.tempOrder,onUpdatePaid:_.updatePaid},null,8,["order","onUpdatePaid"]),$(M,{ref:"delModal",item:e.tempOrder,onDelItem:_.delOrder},null,8,["item","onDelItem"])])}const Qt=f(wt,[["render",Ht]]);export{Qt as default};
